(this.webpackJsonpmetronome=this.webpackJsonpmetronome||[]).push([[0],{14:function(e,t,n){var i=n(21),a=[];e.exports=function(){var e=new Worker(n.p+"5229467faaf4ec1feba7.worker.js",{name:"[hash].worker.js"});return i(e,a),e}},28:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var i=n(7),a=n(0),s=n(3),o=n(4),c=n(6),r=n(5),l=n(2),h=n.n(l),u=n(13),m=n.n(u),d=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).canvasRef=h.a.createRef(),a.resetCanvas=a.resetCanvas.bind(Object(i.a)(a)),window.onorientationchange=a.resetCanvas,window.onresize=a.resetCanvas,a.curNote=null,a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.resetCanvas()}},{key:"componentDidUpdate",value:function(){this.drawCanvas()}},{key:"resetCanvas",value:function(){this.canvasRef.current.width=window.innerWidth,window.scrollTo(0,0),this.drawCanvas()}},{key:"drawCanvas",value:function(){var e=this.canvasRef.current,t=e.getContext("2d");t.fillStyle=this.props.theme.background,t.globalAlpha=1,t.fillRect(0,0,e.width,e.height);for(var n=Math.min(e.width/this.props.beatsPerBar/5,36),i=0;i<this.props.beatsPerBar;i++){var a;t.fillStyle=this.props.theme.light,t.globalAlpha=1,t.shadowBlur=0,this.props.curNote&&this.props.curNote.beat===i&&0===this.props.curNote.click&&(this.curNote=this.props.curNote),(null===(a=this.curNote)||void 0===a?void 0:a.beat)===i&&(this.props.isplaying?(t.fillStyle="red",t.shadowColor="red",t.shadowBlur=n):this.curNote=null),t.beginPath(),t.arc(i*(e.width/this.props.beatsPerBar)+e.width/this.props.beatsPerBar/2,e.height/2,n,0,2*Math.PI),t.fill()}}},{key:"render",value:function(){return Object(a.jsx)("div",{className:"visualizer",children:Object(a.jsx)("canvas",{ref:this.canvasRef,id:"canvas",height:"100",width:"100"})})}}]),n}(h.a.Component),p=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={lastNoteDrawn:null,nextNoteTime:0,percentage:0,curNote:null},a.updateAnimation=a.updateAnimation.bind(Object(i.a)(a)),a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.rAF=requestAnimationFrame(this.updateAnimation)}},{key:"updateAnimation",value:function(){if(this.props.isplaying){for(var e=this.props.audiocontext.currentTime,t=this.props.queue,n=this.state.lastNoteDrawn;t.length&&t[0].time<e;)n=t[0],t.splice(0,1);var i=(60/this.props.tempo-(this.props.nbt-e))/(60/this.props.tempo);i<0&&(i=0),i>1&&(i=1),n!==this.state.lastNoteDrawn?this.setState((function(e,t){return{percentage:i,nextNoteTime:n.time+60/t.tempo}})):this.setState((function(e,t){return{percentage:i}})),this.setState((function(e,t){return{curNote:n}}))}this.rAF=requestAnimationFrame(this.updateAnimation)}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.rAF)}},{key:"render",value:function(){return Object(a.jsx)(d,{percentage:this.state.percentage,isplaying:this.props.isplaying,beatsPerBar:this.props.beatsPerBar,curNote:this.state.curNote,theme:this.props.theme})}}]),n}(h.a.Component),j=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"render",value:function(){return!0===this.props.increment?Object(a.jsx)("button",{name:"increment-"+this.props.id,onClick:this.props.onClick,className:"btn-circle",children:"+"}):Object(a.jsx)("button",{name:"decrement-"+this.props.id,onClick:this.props.onClick,className:"btn-circle",children:"\u2013"})}}]),n}(h.a.Component);function b(e){return Object(a.jsx)("div",{className:"slider-row",children:Object(a.jsx)("input",{type:"range",id:"tempo",min:e.minTempo,max:e.maxTempo,step:"1",value:e.tempo,onChange:e.onChange})})}var v=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"tempo-input-row",children:[Object(a.jsx)(j,{increment:!1,id:"tempo",onClick:this.props.onClick}),Object(a.jsxs)("div",{className:"tempo-label",children:[Object(a.jsx)("span",{id:"tempo-label",children:this.props.tempo}),Object(a.jsx)("span",{className:"bpm-label",children:"\xa0bpm"})]}),Object(a.jsx)(j,{increment:!0,id:"tempo",onClick:this.props.onClick})]}),Object(a.jsx)(b,{onChange:this.props.onChange,tempo:this.props.tempo,maxTempo:this.props.maxTempo,minTempo:this.props.minTempo})]})}}]),n}(h.a.Component),k=n(14),x=n.n(k),f=n(8),g=n(9),O=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s.a)(this,e),this.time=t,this.beat=n,this.click=i};function C(e){var t=Object(a.jsx)(g.a,{icon:f.c}),n=Object(a.jsx)(g.a,{icon:f.d});return Object(a.jsx)("div",{className:"play-row",children:Object(a.jsx)("button",{className:"btn-circle large",onClick:e.onClick,name:"play-button",children:"Start"===e.value?t:n})})}var y=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){var a;Object(s.a)(this,n),(a=t.call(this,e)).state={noteLength:.05,lookahead:25,scheduleAheadTime:.1,tempo:120,maxTempo:240,minTempo:30,nextBeat:0,nextBeatTime:0,nextClick:0,nextClickTime:0,isPlaying:!1,audioUnlocked:!1,noteQueue:[],beatsPerBar:4,clicksPerBeat:1},a.handleChange=a.handleChange.bind(Object(i.a)(a)),a.handleClick=a.handleClick.bind(Object(i.a)(a)),a.handleTick=a.handleTick.bind(Object(i.a)(a));var o=window.AudioContext||window.webkitAudioContext||!1;return a.audioContext=new o({sampleRate:44100}),a.unlockAudio(),a.timerWorker=x()(),a.timerWorker.onmessage=function(e){"tick"===e.data?a.handleTick():console.log("Worker: "+e.data)},a.timerWorker.postMessage({interval:a.state.lookahead}),a}return Object(o.a)(n,[{key:"scheduleNote",value:function(e){var t=this.audioContext.createOscillator(),n=this.audioContext.createGain();t.connect(n),n.connect(this.audioContext.destination),0!==e.beat?t.frequency.value=440:t.frequency.value=880,0!==e.click&&(t.frequency.value=330),t.start(this.state.nextClickTime),n.gain.setTargetAtTime(0,this.state.nextClickTime+this.state.noteLength,.015),t.stop(this.state.nextClickTime+2*this.state.noteLength)}},{key:"handleTick",value:function(){var e=this;if(this.state.isPlaying)for(var t=function(){var t=e.state.nextBeat,n=e.state.nextClick,i=60/e.state.tempo,a=e.state.nextBeatTime,s=new O(e.state.nextClickTime,t,n);0===s.click&&(a=s.time+i),e.scheduleNote(s),e.state.clicksPerBeat>1?++n>=e.state.clicksPerBeat&&(n=0,++t>=e.state.beatsPerBar&&(t=0)):(t++,n=0,t>=e.state.beatsPerBar&&(t=0)),e.setState((function(o,c){return{noteQueue:o.noteQueue.concat(s),nextClickTime:o.nextClickTime+1/e.state.clicksPerBeat*i,nextBeatTime:a,nextBeat:t,nextClick:n}}))};this.state.nextClickTime<this.audioContext.currentTime+this.state.scheduleAheadTime;)t()}},{key:"unlockAudio",value:function(){var e=this.audioContext.createBuffer(1,1,22050),t=this.audioContext.createBufferSource();t.buffer=e,t.start(this.audioContext.currentTime)}},{key:"fadeAnimation",value:function(e){document.getElementById(e).classList.remove("animation-fade"),document.getElementById(e).offsetWidth,document.getElementById(e).classList.add("animation-fade")}},{key:"handleClick",value:function(e){var t=0;switch(e.target.name){case"increment-tempo":return this.fadeAnimation("tempo-label"),t=parseInt(this.state.tempo)+1,void this.setState((function(e){return{tempo:t>e.maxTempo?e.tempo:t}}));case"decrement-tempo":return this.fadeAnimation("tempo-label"),t=parseInt(this.state.tempo)-1,void this.setState((function(e){return{tempo:t<e.minTempo?e.tempo:t}}))}if(this.timerWorker.postMessage(this.state.isPlaying?"stop":"start"),this.state.isPlaying)this.audioContext.close(),this.setState((function(e){return{isPlaying:!e.isPlaying,audioUnlocked:!1,noteQueue:[],nextClickTime:0,nextBeat:0,nextClick:0}}));else{var n=window.AudioContext||window.webkitAudioContext||!1;this.audioContext=new n({sampleRate:44100}),this.state.audioUnlocked||this.unlockAudio(),this.setState((function(e){return{isPlaying:!e.isPlaying,audioUnlocked:!0}}))}}},{key:"handleChange",value:function(e){"beat-select"!==e.target.name?"click-select"!==e.target.name?(this.fadeAnimation("tempo-label"),this.setState({tempo:e.target.value})):this.setState({clicksPerBeat:e.target.value}):this.setState({beatsPerBar:e.target.value})}},{key:"render",value:function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(v,{onChange:this.handleChange,onClick:this.handleClick,tempo:this.state.tempo,maxTempo:this.state.maxTempo,minTempo:this.state.minTempo}),Object(a.jsx)(p,{tempo:this.state.tempo,nbt:this.state.nextBeatTime,isplaying:this.state.isPlaying,queue:this.state.noteQueue,audiocontext:this.audioContext,beatsPerBar:this.state.beatsPerBar,theme:this.props.theme}),Object(a.jsx)(C,{value:this.state.isPlaying?"Stop":"Start",onClick:this.handleClick}),Object(a.jsxs)("div",{className:"settings-row",children:[Object(a.jsx)("div",{className:"select-wrapper",children:Object(a.jsxs)("select",{value:this.state.beatsPerBar,onChange:this.handleChange,name:"beat-select",children:[Object(a.jsx)("option",{value:"2",children:"2/4"}),Object(a.jsx)("option",{value:"3",children:"3/4"}),Object(a.jsx)("option",{value:"4",children:"4/4"}),Object(a.jsx)("option",{value:"5",children:"5/4"}),Object(a.jsx)("option",{value:"6",children:"6/4"}),Object(a.jsx)("option",{value:"7",children:"7/4"})]})}),Object(a.jsx)("div",{className:"select-wrapper",children:Object(a.jsxs)("select",{value:this.state.clicksPerBeat,onChange:this.handleChange,name:"click-select",children:[Object(a.jsx)("option",{value:"1",children:"1 click"}),Object(a.jsx)("option",{value:"2",children:"2 clicks"}),Object(a.jsx)("option",{value:"3",children:"3 clicks"}),Object(a.jsx)("option",{value:"4",children:"4 clicks"}),Object(a.jsx)("option",{value:"5",children:"5 clicks"}),Object(a.jsx)("option",{value:"6",children:"6 clicks"}),Object(a.jsx)("option",{value:"7",children:"7 clicks"})]})})]})]})}}]),n}(h.a.Component),T=(h.a.Component,n(27),n(28),n(15)),w=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e)}return Object(o.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{className:"navbar",children:[Object(a.jsxs)("div",{className:"logo",children:[Object(a.jsx)(g.a,{icon:f.b}),"\xa0\xa0\xa0Metronome"]}),Object(a.jsx)("div",{children:Object(a.jsx)("button",{onClick:this.props.toggleTheme,children:"dark"===this.props.theme?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(g.a,{icon:f.e}),"\xa0\xa0Too dark?"]}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(g.a,{icon:f.a}),"\xa0\xa0Too bright?"]})})})]})}}]),n}(h.a.Component),B=function(e){Object(c.a)(n,e);var t=Object(r.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={isMenuOpen:!1,maxBeats:12,minBeats:1,maxClicks:12,minClicks:1,lightTheme:{background:"#f0f0f0",light:"#ccc"},darkTheme:{background:"#424242",light:"#595959"},theme:"light"},a.toggleTheme=a.toggleTheme.bind(Object(i.a)(a)),a}return Object(o.a)(n,[{key:"toggleTheme",value:function(){this.setState((function(e){return{theme:"dark"===e.theme?"light":"dark"}}))}},{key:"fadeAnimation",value:function(e){document.getElementById(e).classList.remove("animation-fade"),document.getElementById(e).offsetWidth,document.getElementById(e).classList.add("animation-fade")}},{key:"render",value:function(){return Object(a.jsx)("div",{className:"dark"===this.state.theme?"theme-dark":"theme-light",children:Object(a.jsxs)("div",{className:"app-wrapper",children:[Object(a.jsxs)("div",{className:"app",children:[Object(a.jsx)(w,{onClick:null,toggleTheme:this.toggleTheme,theme:this.state.theme}),Object(a.jsx)(y,{theme:"dark"===this.state.theme?this.state.darkTheme:this.state.lightTheme})]}),Object(a.jsxs)("footer",{children:[Object(a.jsxs)("a",{href:"https://github.com/aviolin/metronome/",target:"_blank",children:[Object(a.jsx)(g.a,{icon:T.a}),"\xa0\xa0View the source on Github"]}),Object(a.jsx)("p",{children:"\xa9 2021, Arlo Adams"})]})]})})}}]),n}(h.a.Component);m.a.render(Object(a.jsx)(h.a.StrictMode,{children:Object(a.jsx)(B,{})}),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.a520d2c8.chunk.js.map